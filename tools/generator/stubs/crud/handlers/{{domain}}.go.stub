package handlers

import (
	{{domainPascalCase}}Create "go-skeleton/internal/application/services/{{domainPascalCase}}/CREATE"
	{{domainPascalCase}}Delete "go-skeleton/internal/application/services/{{domainPascalCase}}/DELETE"
	{{domainPascalCase}}Edit "go-skeleton/internal/application/services/{{domainPascalCase}}/EDIT"
	{{domainPascalCase}}Get "go-skeleton/internal/application/services/{{domainPascalCase}}/GET"
	{{domainPascalCase}}List "go-skeleton/internal/application/services/{{domainPascalCase}}/LIST"
	{{domainPascalCase}}Repository "go-skeleton/internal/repositories/{{domainPascalCase}}"
	"go-skeleton/pkg/idCreator"
	"go-skeleton/pkg/logger"
	"go-skeleton/pkg/registry"
	"go-skeleton/pkg/validator"

	"github.com/labstack/echo/v4"
)

type {{domainPascalCase}}Handlers struct {
	{{domainPascalCase}}Repository *{{domainPascalCase}}Repository.{{domainPascalCase}}Repository

	logger    *logger.Logger
	idCreator *idCreator.IdCreator
	validator *validator.Validator
}

func New{{domainPascalCase}}Handlers(reg *registry.Registry) *{{domainPascalCase}}Handlers {
	return &{{domainPascalCase}}Handlers{
		{{domainPascalCase}}Repository: reg.Inject("{{domainPascalCase}}Repository").(*{{domainPascalCase}}Repository.{{domainPascalCase}}Repository),
		logger:          reg.Inject("logger").(*logger.Logger),
		idCreator:       reg.Inject("idCreator").(*idCreator.IdCreator),
		validator:       reg.Inject("validator").(*validator.Validator),
	}
}

func (hs *{{domainPascalCase}}Handlers) HandleGet{{domainPascalCase}}(context echo.Context) error {
	s := {{domainPascalCase}}Get.NewService(hs.logger, hs.{{domainPascalCase}}Repository)
	data := new({{domainPascalCase}}Get.Data)

	if errors := context.Bind(data); errors != nil {
		return context.JSON(422, errors)
	}

	s.Execute(
		{{domainPascalCase}}Get.NewRequest(data),
	)
	response, err := s.GetResponse()
	if err != nil {
		return context.JSON(err.Status, err)
	}
	return context.JSON(response.Status, response)
}

func (hs *{{domainPascalCase}}Handlers) HandleCreate{{domainPascalCase}}(context echo.Context) error {
	s := {{domainPascalCase}}Create.NewService(hs.logger, hs.{{domainPascalCase}}Repository, hs.idCreator)
	data := new({{domainPascalCase}}Create.Data)

	if errors := context.Bind(data); errors != nil {
		return context.JSON(422, errors)
	}

	s.Execute(
		{{domainPascalCase}}Create.NewRequest(data, hs.validator),
	)
	response, err := s.GetResponse()
	if err != nil {
		return context.JSON(err.Status, err)
	}
	return context.JSON(response.Status, response)
}

func (hs *{{domainPascalCase}}Handlers) HandleEdit{{domainPascalCase}}(context echo.Context) error {
	s := {{domainPascalCase}}Edit.NewService(hs.logger, hs.{{domainPascalCase}}Repository)
	data := new({{domainPascalCase}}Edit.Data)

	if errors := context.Bind(data); errors != nil {
		return context.JSON(422, errors)
	}

	s.Execute(
		{{domainPascalCase}}Edit.NewRequest(data, hs.validator),
	)

	response, err := s.GetResponse()
	if err != nil {
		return context.JSON(err.Status, err)
	}
	return context.JSON(response.Status, response)
}

func (hs *{{domainPascalCase}}Handlers) HandleList{{domainPascalCase}}(context echo.Context) error {
<<<<<<< Updated upstream
	s := {{domainCamelCase}}List.NewService(hs.logger, hs.{{domainPascalCase}}Repository)
	s.Execute(
		{{domainCamelCase}}List.NewRequest(),
=======
	s := {{domainPascalCase}}List.NewService(hs.logger, hs.{{domainPascalCase}}Repository)
	data := new({{domainPascalCase}}List.Data)

	bindErr := echo.QueryParamsBinder(context).
		Int("page", &data.Page).
		BindError()

	if bindErr != nil {
		return context.JSON(400, bindErr)
	}

	s.Execute(
		{{domainPascalCase}}List.NewRequest(data),
>>>>>>> Stashed changes
	)
	response, err := s.GetResponse()
	if err != nil {
		return context.JSON(err.Status, err)
	}
	return context.JSON(response.Status, response)
}

func (hs *{{domainPascalCase}}Handlers) HandleDelete{{domainPascalCase}}(context echo.Context) error {
	s := {{domainPascalCase}}Delete.NewService(hs.logger, hs.{{domainPascalCase}}Repository)
	data := new({{domainPascalCase}}Delete.Data)

	if errors := context.Bind(data); errors != nil {
		return context.JSON(422, errors)
	}

	s.Execute(
		{{domainPascalCase}}Delete.NewRequest(data),
	)
	response, err := s.GetResponse()
	if err != nil {
		return context.JSON(err.Status, err)
	}
	return context.JSON(response.Status, response)
}
